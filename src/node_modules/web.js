var http = require("http");
var url = require("url");

exports.get = get;
exports.post = post;

function get(path, callback)
{
	load("GET", path, null, callback);
}

function post(path, data, callback)
{
	load("POST", path, data, callback);
}

function load(method, path, data, callback)
{
	var obj = url.parse(path);
	
	var options = {
		"host": obj.hostname,
		"port": obj.port || 80,
		"path": obj.pathname,
		"method": method
	};

	var request = http.request(options, function(response){
		var body = null;
		response.on("data", function(chunk){
			body = body ? Buffer.concat([body, chunk]) : chunk;
		});
		response.on("end", function(){
			response.removeAllListeners();
			request.removeAllListeners();
			callback(200 == response.statusCode, body);
		});
	});
	
	request.on("error", function(err){
		request.removeAllListeners();
		callback(false, err);
	});
	
	if(data){
		request.write(JSON.stringify(data));
	}

	request.end();
}